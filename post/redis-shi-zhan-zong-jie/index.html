<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Smy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta name="description" content="A student who is constantly striving"/>
<meta name="keywords" content="A student who is constantly striving"/>

<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
<link rel="shortcut icon" href="https://saseke.github.io/favicon.ico">

<link rel="stylesheet" href="https://saseke.github.io/styles/main.css">

<!-- Modernizr JS -->
<script src="https://saseke.github.io/media/scripts/modernizr-2.6.2.min.js"></script>
<!-- FOR IE9 below -->
<!--[if lt IE 9]>
<scripts src="https://saseke.github.io/media/scripts/respond.min.js"></scripts>
<![endif]-->

<!-- Comment -->



<!-- katex -->
<!--<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet">-->

<link href="https://cdn.bootcss.com/font-awesome/5.11.2/css/all.min.css" rel="stylesheet">



</head>
<body>
    <div id="fh5co-offcanvas">
    <a href="#!" class="fh5co-close-offcanvas js-fh5co-close-offcanvas">
        <span><i class="icon-cross3"></i> <span>Close</span></span>
    </a>
    <div class="fh5co-bio">
        <figure>
            <img src="https://saseke.github.io/images/avatar.png" alt="Smy"
                 class="img-responsive">
        </figure>
        <a href="https://saseke.github.io/post/about/"><h3 class="heading">ABOUT ME</h3></a>
        <h2>Smy</h2>
        <p>A student who is constantly striving</p>
        <ul class="fh5co-social">
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
        </ul>
    </div>

    <div class="fh5co-menu">

        <!-- 标签 -->
        <div class="fh5co-box">
            <a href="https://saseke.github.io/tags/"><h3 class="heading">👉标签</h3></a>
            <ul>
                
                    <li><a href="https://saseke.github.io/tag/ugAnwOalE/">paper</a></li>
                
                    <li><a href="https://saseke.github.io/tag/algorithm/">algorithm</a></li>
                
                    <li><a href="https://saseke.github.io/tag/diary/">diary</a></li>
                
                    <li><a href="https://saseke.github.io/tag/AwsgcjQkK/">c++</a></li>
                
                    <li><a href="https://saseke.github.io/tag/lbnI2Wnls/">distributed</a></li>
                
                    <li><a href="https://saseke.github.io/tag/tZS19L4dr/">file system</a></li>
                
                    <li><a href="https://saseke.github.io/tag/vT5ZzxYvS/">redis</a></li>
                
                    <li><a href="https://saseke.github.io/tag/JEV3JRwPx/">architecture</a></li>
                
                    <li><a href="https://saseke.github.io/tag/mgPa4qhSL/">storm</a></li>
                
                    <li><a href="https://saseke.github.io/tag/rVd9T6I6y/">hbase</a></li>
                
                    <li><a href="https://saseke.github.io/tag/RnNn2Kd83/">hive</a></li>
                
                    <li><a href="https://saseke.github.io/tag/eExHX0970/">leetcode</a></li>
                
            </ul>
        </div>
    </div>
</div>

<header id="fh5co-header">
    <div class="container-fluid">
        <div class="row">
            <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
            <ul class="fh5co-social">
                
                    <li>
                        <a href="/"
                        
                        >
                            HomePage
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives"
                        
                        >
                            Archive
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags"
                        
                        >
                            Tag
                        </a>
                    </li>
                
                    <li>
                        <a href="/post/about"
                        
                        >
                            About
                        </a>
                    </li>
                
            </ul>
            <div class="col-lg-12 col-md-12 text-center">
                <h1 id="fh5co-logo">
                    <a href="https://saseke.github.io">Smy </a>
                </h1>
            </div>
        </div>
    </div>
</header>


    <!--  <a href="#" class="fh5co-post-prev"><span>👈 Prev</span></a>-->
    <!--  <a href="#" class="fh5co-post-next"><span>Next 👉</span></a>-->

    <!-- 等gridea出自定义页面功能再优化一下 -->
    
        <div class="container-fluid">
    <div class="row fh5co-post-entry single-entry">
        <article class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2 col-xs-12 col-xs-offset-0">
            <figure class="animate-box">
                
                    <img src="https://saseke.github.io/post-images/redis-shi-zhan-zong-jie.png" alt="Redis实战-总结" class="img-responsive">
                
            </figure>
            <span class="fh5co-meta animate-box">
                
                    <div class="tag-container">
                        
                            <a href="https://saseke.github.io/tag/vT5ZzxYvS/" class="tag">redis, </a>
                        
                    </div>
                
            </span>
            <h2 class="fh5co-article-title animate-box">Redis实战-总结</h2>
            <ol class="breadcrumb fh5co-meta fh5co-date animate-box" style="margin-bottom:0; background-color:#f8f9fa">
                <li>2022-05-24</li>
                <li>1868字</li>
                <li>7 min read</li>
            </ol>

            <div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 col-xs-12 col-xs-offset-0 text-left content-article">
                <div class="row">
                    <div class="col-md-12 animate-box post-content">
                        <p> <p>Redis实战整体分为三部分</p>
<ol>
<li>Redis的简单使用</li>
<li>Redis构建更加复杂的应用</li>
<li>对Redis进行扩展</li>
</ol>
<h1 id="1-redis-简单使用">1. Redis 简单使用</h1>
<ol>
<li>处理用户登录请求，缓存用户的token</li>
<li>存储购物车信息</li>
<li>存储网页的静态资源</li>
<li>针对某些一直动态变换的数据（促销活动）</li>
<li>网页分析：如果商品很多的话，全部存储到Redis中，显然不合适，那么我可以针对商品按照访问量进行排序，优先缓存那些访问量高的商品</li>
</ol>
<h1 id="2-redis命令">2. Redis命令</h1>
<p><font color='red'>Redis如何需要使用多个字段做key时候，字段与字段之间通过:分割，不用-这种的</font><br>
除了常见的字符串,列表，无序集合，散列，有序集合之外 ，Redis还支持发布，订阅的功能，但是功能不够完善，存在问题，可能发生数据丢失问题。</p>
<h2 id="21-redis支持数据排序">2.1 Redis支持数据排序</h2>
<p>sort命令可以对列表，集合，有序集合，字符串进行排序。但是排序是不影响原来的数据的<br>
<strong>有序集合特殊使用情况</strong><br>
<font color='red'>将有序集合的分值全都设置为0,那么所有的 Key 都会按照字母顺序进行排序。</font></p>
<h2 id="22-redis事务">2.2 Redis事务</h2>
<p>Redis的事务比较简单，通过使用<code>MULTI</code>和<code>EXEC</code>两个命令来实现事务。Redis事务不支持回滚</p>
<h2 id="23-redis键过期">2.3 Redis键过期</h2>
<p>Redis可以通过<code>expire</code>来为数据设置过期时间</p>
<h1 id="3-数据安全与性能保障">3. 数据安全与性能保障</h1>
<p>安全方面：考虑数据持久化+复制备份<br>
性能保障:</p>
<h2 id="31-持久化选项">3.1 持久化选项</h2>
<p>Redis数据持久化有两种选择:快照 or AOF。两者可以同时使用</p>
<h3 id="311-快照">3.1.1 快照</h3>
<p>创建当前时间段内存数据的副本，然后存储起来。<br>
优点：每隔一段时间进行快照，磁盘IO次数少<br>
缺点：如果系统发生崩溃，用户将丢失最近一次快照间隔之间的数据</p>
<h3 id="312-aof持久化">3.1.2 AOF持久化</h3>
<p>AOF:将执行的所有命令放到AOF文件的末尾。如果系统崩溃，重启之后重新运行一遍AOF文件<br>
优点：用户丢失的数据微乎其微<br>
缺点：AOF文件过大，Redis重启速度很慢</p>
<h3 id="313-aof文件重写压缩">3.1.3 AOF文件重写/压缩</h3>
<p>使用<code>BGREWRITEAOF</code>来重写AOF文件，实现AOF重写</p>
<h2 id="32-复制备份">3.2 复制备份</h2>
<h3 id="321-redis复制启动过程">3.2.1 Redis复制启动过程</h3>
<p>Redis服务器分为主服务器和从服务器。每次数据同步都从主服务器同步到从服务器。数据同步的过程如下：</p>
<ol>
<li>在第一次进行数据同步的时候，主服务器会创建当前Redis的快照，将快照传给从服务器</li>
<li>对于在传递快照过程中的命令，主服务器会存储到缓冲区中。当快照发送完毕之后，会将存储在缓冲区中的数据发送给从服务器</li>
<li>当缓冲区数据发送完毕之后。之后的每一条命令主服务器都会发送给从服务器<br>
<font color='red'>从服务器在接收到主服务器的数据之后，从服务器原来的数据将会完全丢失，替换成从主服务器拉取过来的数据</font></li>
</ol>
<h3 id="322-主从链">3.2.2 主从链</h3>
<p>当主服务器需要同步数据给许多从服务器，会可能存在数据同步不及时，加大主服务器资源消耗等问题。我们可以通过从节点也有自己的从节点，从而实现类似于一个树形结构，从而减少主服务器的压力。<br>
<img src="https://saseke.github.io/post-images/1655257957461.png" alt="" loading="lazy"></p>
<h3 id="323-检验磁盘是否写入">3.2.3 检验磁盘是否写入</h3>
<p>虽然将主服务器数据同步给从服务器，但是需要确认数据是否发送给从服务器。可以在将所有主服务器数据同步到从服务器之后，再向主服务器写入一个虚拟的值，然后去从服务器查看该数据是否同步过去，从而实现检验磁盘是否写入。</p>
<h2 id="33-处理系统故障">3.3 处理系统故障</h2>
<h3 id="331-验证快照文件和aof文件完整性">3.3.1 验证快照文件和AOF文件完整性</h3>
<p>考虑到服务器可能会断电，重启等操作。Redis必须考虑到如何处理系统故障<br>
Redis提供了<code>redis-check-aof</code>和<code>redis-check-dump</code>两个命令来对aof和快照文件进行校验，并对对应的文件进行修复操作。</p>
<ol>
<li>Redis的AOF的文件：Redis处理故障会将aof文件的最后一条不完整的命令进行删除</li>
<li>Redis的快照文件：Redis不能对其进行恢复。只能通过主从备份，然后通过校验来确保快照的完整性</li>
</ol>
<h3 id="332-更换故障主服务器">3.3.2 更换故障主服务器</h3>
<p>Redis可以通过使用<code>SAVE</code>指令来实现更换主服务器</p>
<h2 id="34-redis事务">3.4 Redis事务</h2>
<p>Redis中采用了很简单的方式来实现Redis的事务。通过使用<code>MULTI</code>和<code>EXEC</code>命令来执行数据。Redis没有使用类似于关系型数据库的加锁操作来实现事务，而是通过使用<code>WATCH</code>命令来实现，本质上是使用了乐观所来实现。</p>
<pre><code class="language-shell">MULTI  :   标记一个事务块的开始
EXEC   :   标记一个事务块的结束
WATCH : 监控一个或者多个KEY对应的数据，如果数据在执行事务的过程中发生改变，则会报错
UNWATCH: 取消WATCH对所有KEY的监控
DISCARD : 取消事务，放弃WATCH的所有KEY
</code></pre>
<h2 id="35-非事务流水线">3.5 非事务流水线</h2>
<p>对于传统的事务来说，使用<code>MULTI</code>,<code>EXEC</code>指令去执行命令，相对来说会消耗大量的资源。因此我们考虑另外一种非事务型流水线的技术去实现批量的命令处理</p>
<blockquote>
<p>使用Redis提供的pipline去实现批量的命令处理<br>
使用非事务流水线技术对系统性能的提升很大</p>
</blockquote>
<h1 id="4-使用redis构建支持程序">4. 使用Redis构建支持程序</h1>
<h2 id="41-使用redis来记录日志">4.1 使用Redis来记录日志</h2>
<h3 id="410-前置知识">4.1.0 前置知识</h3>
<ol>
<li>在Linux中有两种常用的记录日志的方式，一种是将日志存储到日志文件中。每隔一段时间会生成新的日志文件；另外一种是使用syslog服务。</li>
</ol>
<h3 id="411-记录最新的日志">4.1.1 记录最新的日志</h3>
<p>通过创建Redis的list队列，通过使用Redis命令<code>LTRIM</code>来实现仅保留固定条数的日志，从而实现仅记录最新日志的功能。</p>
<h3 id="412-记录常见日志">4.1.2 记录常见日志</h3>
<p>将一段时间内的日志放入有序列表中，次数作为权值。每隔一段时间，更新有序列表中的日志。</p>
<h3 id="413-查找ip对应的城市和国家">4.1.3 查找ip对应的城市和国家</h3>
<p>现在都直接调用现成的接口，没必要用 Redis 存储那么大的 IP 数据库</p>
<h3 id="414-服务配置信息">4.1.4 服务配置信息</h3>
<p>将服务的配置信息存储在 Redis 中，可以避免系统重启等操作需要重新读取磁盘中的配置文件信息。</p>
<h1 id="5-使用redis构建应用程序组件">5. 使用Redis构建应用程序组件</h1>
<h2 id="51-自动补全">5.1 自动补全</h2>
<p>通过有序集合来实现。向有序集合中添加元素来创建查找范围，并在取得范围内元素之后移除之前添加的元素。</p>
<h2 id="分布式锁">分布式锁</h2>
<p>Redis Client 通过竞争设置 Redis 的某个Key来获取锁。分布式锁需要考虑：加锁，释放锁，锁超时等问题。而 Redis 的 WATCH 是乐观锁，分布式锁是悲观锁。</p>
 </p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 animate-box">
                        
                            <div class="next-post">
                                <div class="next">下一篇</div>
                                <a href="https://saseke.github.io/post/che-xin-bian-cheng/">
                                    <h3 class="post-title">
                                        C++核心编程
                                    </h3>
                                </a>
                            </div>
                        
                    </div>
                </div>

                <div class="row">
    <div class="col-md-12 animate-box">
        
    </div>
</div>

            </div>

        </article>
    </div>
</div>

    

    <!-- 返回顶部 -->
    <div class="back-to-top">
    
        <a href="#!" id="tool-toc" class="hidden-xs hidden-sm">
            <i class="fa fa-map"></i>
        </a>
        <br>
    
    <a href="#top" class="hidden-xs hidden-sm"><i class="fa fa-paper-plane"></i></a>
</div>

<div class="post-toc animated fadeInRight hidden-xs hidden-sm" style="display: none;">
    <ul class="markdownIt-TOC">
<li><a href="#1-redis-%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8">1. Redis 简单使用</a></li>
<li><a href="#2-redis%E5%91%BD%E4%BB%A4">2. Redis命令</a>
<ul>
<li><a href="#21-redis%E6%94%AF%E6%8C%81%E6%95%B0%E6%8D%AE%E6%8E%92%E5%BA%8F">2.1 Redis支持数据排序</a></li>
<li><a href="#22-redis%E4%BA%8B%E5%8A%A1">2.2 Redis事务</a></li>
<li><a href="#23-redis%E9%94%AE%E8%BF%87%E6%9C%9F">2.3 Redis键过期</a></li>
</ul>
</li>
<li><a href="#3-%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BF%9D%E9%9A%9C">3. 数据安全与性能保障</a>
<ul>
<li><a href="#31-%E6%8C%81%E4%B9%85%E5%8C%96%E9%80%89%E9%A1%B9">3.1 持久化选项</a>
<ul>
<li><a href="#311-%E5%BF%AB%E7%85%A7">3.1.1 快照</a></li>
<li><a href="#312-aof%E6%8C%81%E4%B9%85%E5%8C%96">3.1.2 AOF持久化</a></li>
<li><a href="#313-aof%E6%96%87%E4%BB%B6%E9%87%8D%E5%86%99%E5%8E%8B%E7%BC%A9">3.1.3 AOF文件重写/压缩</a></li>
</ul>
</li>
<li><a href="#32-%E5%A4%8D%E5%88%B6%E5%A4%87%E4%BB%BD">3.2 复制备份</a>
<ul>
<li><a href="#321-redis%E5%A4%8D%E5%88%B6%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B">3.2.1 Redis复制启动过程</a></li>
<li><a href="#322-%E4%B8%BB%E4%BB%8E%E9%93%BE">3.2.2 主从链</a></li>
<li><a href="#323-%E6%A3%80%E9%AA%8C%E7%A3%81%E7%9B%98%E6%98%AF%E5%90%A6%E5%86%99%E5%85%A5">3.2.3 检验磁盘是否写入</a></li>
</ul>
</li>
<li><a href="#33-%E5%A4%84%E7%90%86%E7%B3%BB%E7%BB%9F%E6%95%85%E9%9A%9C">3.3 处理系统故障</a>
<ul>
<li><a href="#331-%E9%AA%8C%E8%AF%81%E5%BF%AB%E7%85%A7%E6%96%87%E4%BB%B6%E5%92%8Caof%E6%96%87%E4%BB%B6%E5%AE%8C%E6%95%B4%E6%80%A7">3.3.1 验证快照文件和AOF文件完整性</a></li>
<li><a href="#332-%E6%9B%B4%E6%8D%A2%E6%95%85%E9%9A%9C%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8">3.3.2 更换故障主服务器</a></li>
</ul>
</li>
<li><a href="#34-redis%E4%BA%8B%E5%8A%A1">3.4 Redis事务</a></li>
<li><a href="#35-%E9%9D%9E%E4%BA%8B%E5%8A%A1%E6%B5%81%E6%B0%B4%E7%BA%BF">3.5 非事务流水线</a></li>
</ul>
</li>
<li><a href="#4-%E4%BD%BF%E7%94%A8redis%E6%9E%84%E5%BB%BA%E6%94%AF%E6%8C%81%E7%A8%8B%E5%BA%8F">4. 使用Redis构建支持程序</a>
<ul>
<li><a href="#41-%E4%BD%BF%E7%94%A8redis%E6%9D%A5%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97">4.1 使用Redis来记录日志</a>
<ul>
<li><a href="#410-%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86">4.1.0 前置知识</a></li>
<li><a href="#411-%E8%AE%B0%E5%BD%95%E6%9C%80%E6%96%B0%E7%9A%84%E6%97%A5%E5%BF%97">4.1.1 记录最新的日志</a></li>
<li><a href="#412-%E8%AE%B0%E5%BD%95%E5%B8%B8%E8%A7%81%E6%97%A5%E5%BF%97">4.1.2 记录常见日志</a></li>
<li><a href="#413-%E6%9F%A5%E6%89%BEip%E5%AF%B9%E5%BA%94%E7%9A%84%E5%9F%8E%E5%B8%82%E5%92%8C%E5%9B%BD%E5%AE%B6">4.1.3 查找ip对应的城市和国家</a></li>
<li><a href="#414-%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF">4.1.4 服务配置信息</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#5-%E4%BD%BF%E7%94%A8redis%E6%9E%84%E5%BB%BA%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%BB%84%E4%BB%B6">5. 使用Redis构建应用程序组件</a>
<ul>
<li><a href="#51-%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8">5.1 自动补全</a></li>
<li><a href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81">分布式锁</a></li>
</ul>
</li>
</ul>

</div>


    
<footer id="fh5co-footer">
  <p>Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a></p>
</footer>


    <!-- jQuery -->
<script src="https://saseke.github.io/media/scripts/jquery.min.js"></script>
<!-- img lazy load -->
<script src="https://saseke.github.io/media/scripts/jquery.lazyload.min.js"></script>
<!-- jQuery Easing -->
<script src="https://saseke.github.io/media/scripts/jquery.easing.1.3.js"></script>
<!-- Bootstrap -->
<script src="https://saseke.github.io/media/scripts/bootstrap.min.js"></script>
<!-- Waypoints -->
<script src="https://saseke.github.io/media/scripts/jquery.waypoints.min.js"></script>
<!-- Main JS -->
<script src="https://saseke.github.io/media/scripts/main.js"></script>
<!-- Md5 Min JS -->
<script src="https://saseke.github.io/media/scripts/md5.min.js"></script>
<!-- katex -->
<!--<script src="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.js"></script>-->
<!-- highlight -->
<script src="https://cdn.bootcss.com/highlight.js/9.15.8/highlight.min.js"></script>


<script type="application/javascript">
    // 代码高亮
    hljs.initHighlightingOnLoad();

    // img 懒加载
    $(function () {
        $("img.lazy").lazyload({
            effect: "fadeIn",  // 懒加载动画
            threshold: 180  // 在图片距离屏幕180px时提前载入
        });
        // tooltip
        $('[data-toggle="tooltip"]').tooltip();

        // 目录
        $('#tool-toc').click(function () {
            $('.post-toc').toggle();
        });
    });

    
</script>




</body>
</html>
